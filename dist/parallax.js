(function(){function n(a){return{transform:a,"-ms-transform":a,"-moz-transform":a,"-webkit-transform":a}}function p(a){return{transition:a,"-ms-transition":a,"-moz-transition":a,"-webkit-transition":a}}function k(a,b){var c,d,e;c=0;d=a.slice(Math.max(a.length-b,1));for(e=0;e<d.length;e++)c+=d[e];return Math.ceil(c/b)}function l(a){var b={};b.y="undefined"!==typeof a.pageY&&(a.pageY||a.pageX)?a.pageY:a.touches[0].pageY;b.x="undefined"!==typeof a.pageX&&(a.pageY||a.pageX)?a.pageX:a.touches[0].pageX;
return b}var f,m,h;f=$(window);m=function(){var a,b,c,d;d={transform:"transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",webkitTransform:"-webkit-transform"};a=document.createElement("p");document.body.insertBefore(a,null);for(b in d)void 0!==a.style[b]&&(a.style[b]="translate3d(1px,1px,1px)",c=window.getComputedStyle(a).getPropertyValue(d[b]));document.body.removeChild(a);return void 0!==c&&0<c.length&&"none"!==c}();h=navigator.userAgent.match(/(iPhone|iPod|iPad|Android|playbook|silk|BlackBerry|BB10|Windows Phone|Tizen|Bada|webOS|IEMobile|Opera Mini)/);
$.fn.parallax=function(a){a=$.extend({style:{},anchors:[],diffHeight:0,animated:!1,scrollingSpeed:1E3,bottomShowScrollBar:!1,callback:function(b,c,a,e){}},a);({attributes:{width:0,height:0,crop:null,currentPage:0,scrollingSpeed:0,animationing:!1},scrollings:[],element:$(this),sectionsElement:null,rootElement:$("body"),prevTime:(new Date).getTime(),init:function(){this.element.wrap($("<div />"));this.wrapElement=this.element.parent();this.sectionsElement=this.element.find(".section");this.touchMoveHandler=
$.proxy(this.touchMoveHandler,this);this.touchStartHandler=$.proxy(this.touchStartHandler,this);this.MouseWheelHandler=$.proxy(this.MouseWheelHandler,this);this.set("crop",!0);this.set("width",f.width());this.set("height",f.height()-a.diffHeight);this.set("anchors",a.anchors);this.set("animated",a.animated);this.set("callback",a.callback);this.set("scrollingSpeed",a.scrollingSpeed);this.set("bottomShowScrollBar",a.bottomShowScrollBar);this.renderStyle();this.bindScrollEvent();this.bindWindowResizeEvent();
this.bindWindowScrollEvent();this.element.data("instance",this)},renderStyle:function(){var b={width:"100%",height:"100%"};$("html").css($.extend({},b,{"overflow-x":"hidden"}));this.rootElement.css(b);this.wrapElement.css($.extend(a.style,{overflow:"hidden",width:this.get("width"),height:this.get("height")}));this.element.css($.extend({},b,{position:"relative"}));this.sectionsElement.css($.extend({},b,{position:"relative"}))},bindScrollEvent:function(){if(h){var b=this.touchStartHandler,c=this.touchMoveHandler;
$(document).on("touchstart",b);$(document).on("touchmove",c)}else{var b=this.element,c=this.MouseWheelHandler,a=b.data("mouseWheelEventName");a||b.data("mouseWheelEventName",a="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?window.addEventListener?"mousewheel":"onmousewheel":"MozMousePixelScroll");window.addEventListener?document.addEventListener(a,c,!1):document.attachEvent(a,c,!1)}},unbindScrollEvent:function(){if(h){var b=this.touchStartHandler,c=this.touchMoveHandler;
$(document).off("touchstart",b);$(document).off("touchmove",c)}else b=this.MouseWheelHandler,c=this.element.data("mouseWheelEventName"),document.addEventListener?document.removeEventListener(c,b,!1):document.detachEvent(c,b)},bindWindowResizeEvent:function(){f.on("resize",$.proxy(function(){this.set("width",f.width());this.set("height",f.height()-a.diffHeight);this.movePage(this.get("currentPage"))},this))},bindWindowScrollEvent:function(){var b=0;f.on("scroll",$.proxy(function(){0===f.scrollTop()&&
(clearTimeout(b),h?this.hideScrollBar():b=setTimeout($.proxy(function(){this.hideScrollBar()},this),100))},this))},MouseWheelHandler:function(b){var c,a,e;b.preventDefault?b.preventDefault():b.returnValue=!1;b=b||window.event;c=(new Date).getTime();a=b.wheelDelta||-b.deltaY||-b.detail;e="undefined"!==typeof b.wheelDeltaX||"undefined"!==typeof b.deltaX;b=Math.abs(b.wheelDeltaX)<Math.abs(b.wheelDelta)||Math.abs(b.deltaX)<Math.abs(b.deltaY)||!e;149<this.scrollings.length&&this.scrollings.shift();this.scrollings.push(Math.abs(a));
200<c-this.prevTime&&(this.scrollings=[]);this.prevTime=c;if(!this.get("animationing")&&k(this.scrollings,10)>=k(this.scrollings,70)&&b)this[0>Math.max(-1,Math.min(1,a))?"nextPage":"prevPage"]()},touchStartHandler:function(b){b.preventDefault();this.element.data("touchStartY",l(b.originalEvent).y)},touchMoveHandler:function(b){b.preventDefault();clearTimeout(this.__timerId);this.__timerId=setTimeout($.proxy(function(){var a,d;this.get("animationing")||(a=this.element.data("touchStartY"),d=l(b.originalEvent).y,
Math.abs(a-d)>this.get("height")/100*5&&(a>d?this.nextPage():d>a&&this.prevPage()))},this),100)},movePage:function(b){this.get("animationing")||b>=this.sectionsElement.length||this.set("currentPage",b)},prevPage:function(){var b=this.get("currentPage");0===b?this.set("animationing",!1):(this.set("animationing",!0),this.set("currentPage",--b))},nextPage:function(){var b=this.get("currentPage");b===this.sectionsElement.length-1?(this.showScrollBar(),this.set("animationing",!1)):(this.set("animationing",
!0),this.set("currentPage",++b))},showScrollBar:function(){this.set("crop",!1);this.unbindScrollEvent()},hideScrollBar:function(){this.set("crop",!0);this.bindScrollEvent()},get:function(b){return this.attributes[b]},set:function(b,a){var d="onChange"+(b.charAt(0).toUpperCase()+b.slice(1));this.attributes[b]=a;if(this[d])this[d](b,a);return this},onChangeWidth:function(b,a){this.wrapElement.css(b,a)},onChangeHeight:function(b,a){this.wrapElement.css(b,a)},onChangeCrop:function(b,a){this.rootElement.css("overflow",
a?"hidden":"visible")},onChangeBottomShowScrollBar:function(b,a){a||(this.hideScrollBar=this.showScrollBar=$.noop)},onChangeAnchors:function(b,a){var d,e,g;if((d=location.hash.slice(1))&&0!==a.length)for(e=0,g=a.length;e<g;e++)if(a[e]===d&&e!==this.get("currentPage")){setTimeout($.proxy(function(){this.movePage(e)},this),100);break}},onChangeCurrentPage:function(b,a){var d,e,g,f;g=this.element;e=a*this.get("height");d=this.get("scrollingSpeed");f=$.proxy(function(){this.set("animationing",!1)},this);
m?(g.data("hasTransitionStyle")||(g.data("hasTransitionStyle",!0),g.css(p("all "+d+"ms ease"))),g.one("transitionend oTransitionEnd webkitTransitionEnd",$.proxy(function(){this.get("callback")(a,this.sectionsElement.eq(a),g,this.get("animated")?f:f())},this)).css(n("translate3d(0px, -"+e+"px, 0px)"))):g.animate({top:-e},d,$.proxy(function(){this.get("callback")(a,this.sectionsElement.eq(a),g,this.get("animated")?f:f())},this))}}).init()}})();
