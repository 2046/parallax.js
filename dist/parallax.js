(function(){var d,l,n;d=$(window);l=j();n=i();$.fn.parallax=function(p){p=$.extend({anchors:[],animated:false,scrollingSpeed:1000,bottomShowScrollBar:false,callback:function(s,u,r,t){}},p);var q={attributes:{width:0,height:0,crop:null,currentPage:0,scrollingSpeed:0,animationing:false},scrollings:[],element:$(this),sectionsElement:null,rootElement:$("body"),prevTime:new Date().getTime(),init:function(){this.element.wrap($("<div />"));this.wrapElement=this.element.parent();this.sectionsElement=this.element.find(".section");this.touchMoveHandler=$.proxy(this.touchMoveHandler,this);this.touchStartHandler=$.proxy(this.touchStartHandler,this);this.MouseWheelHandler=$.proxy(this.MouseWheelHandler,this);this.set("crop",true);this.set("width",d.width());this.set("height",d.height());this.set("anchors",p.anchors);this.set("animated",p.animated);this.set("callback",p.callback);this.set("scrollingSpeed",p.scrollingSpeed);this.set("bottomShowScrollBar",p.bottomShowScrollBar);this.renderStyle();this.bindScrollEvent();this.bindWindowResizeEvent();this.bindWindowScrollEvent();this.element.data("instance",this)},renderStyle:function(){var r={"width":"100%","height":"100%"};$("html").css($.extend({},r,{"overflow-x":"hidden"}));this.rootElement.css(r);this.wrapElement.css({overflow:"hidden",width:this.get("width"),height:this.get("height")});this.element.css($.extend({},r,{"position":"relative"}));this.sectionsElement.css($.extend({},r,{"position":"relative"}))},bindScrollEvent:function(){if(n){a(this.element,this.touchStartHandler,this.touchMoveHandler)}else{b(this.element,this.MouseWheelHandler)}},unbindScrollEvent:function(){if(n){h(this.element,this.touchStartHandler,this.touchMoveHandler)}else{o(this.element,this.MouseWheelHandler)}},bindWindowResizeEvent:function(){d.on("resize",$.proxy(function(){this.set("width",d.width());this.set("height",d.height());this.movePage(this.get("currentPage"))},this))},bindWindowScrollEvent:function(){var r=0;d.on("scroll",$.proxy(function(){if(d.scrollTop()===0){clearTimeout(r);if(n){this.hideScrollBar()}else{r=setTimeout($.proxy(function(){this.hideScrollBar()},this),100)}}},this))},MouseWheelHandler:function(u){var t,v,s,r;u.preventDefault?u.preventDefault():u.returnValue=false;u=u||window.event;t=new Date().getTime();v=u.wheelDelta||-u.deltaY||-u.detail;s=typeof u.wheelDeltaX!=="undefined"||typeof u.deltaX!=="undefined";r=(Math.abs(u.wheelDeltaX)<Math.abs(u.wheelDelta))||(Math.abs(u.deltaX)<Math.abs(u.deltaY)||!s);if(this.scrollings.length>149){this.scrollings.shift()}this.scrollings.push(Math.abs(v));if(t-this.prevTime>200){this.scrollings=[]}this.prevTime=t;if(!this.get("animationing")&&c(this.scrollings,10)>=c(this.scrollings,70)&&r){this[Math.max(-1,Math.min(1,v))<0?"nextPage":"prevPage"]()}},touchStartHandler:function(r){r.preventDefault();this.element.data("touchStartY",g(r.originalEvent).y)},touchMoveHandler:function(r){r.preventDefault();clearTimeout(this.__timerId);this.__timerId=setTimeout($.proxy(function(){var t,s;if(this.get("animationing")){return}t=this.element.data("touchStartY");s=g(r.originalEvent).y;if(Math.abs(t-s)>(this.get("height")/100*5)){if(t>s){this.nextPage()}else{if(s>t){this.prevPage()}}}},this),100)},movePage:function(r){if(this.get("animationing")||(r>=this.sectionsElement.length)){return}this.set("currentPage",r)},prevPage:function(){var r=this.get("currentPage");if(r===0){this.set("animationing",false);return}this.set("animationing",true);this.set("currentPage",--r)},nextPage:function(){var r=this.get("currentPage");if(r===this.sectionsElement.length-1){this.showScrollBar();this.set("animationing",false);return}this.set("animationing",true);this.set("currentPage",++r)},showScrollBar:function(){this.set("crop",false);this.unbindScrollEvent()},hideScrollBar:function(){this.set("crop",true);this.bindScrollEvent()},get:function(r){return this.attributes[r]},set:function(s,t){var r="onChange"+m(s);this.attributes[s]=t;if(this[r]){this[r](s,t)}return this},onChangeWidth:function(r,s){this.wrapElement.css(r,s)},onChangeHeight:function(r,s){this.wrapElement.css(r,s)},onChangeCrop:function(r,s){this.rootElement.css("overflow",s?"hidden":"visible")},onChangeBottomShowScrollBar:function(r,s){if(!s){this.showScrollBar=$.noop;this.hideScrollBar=$.noop}},onChangeAnchors:function(t,u){var v,s,r;if(!(v=location.hash.slice(1))||u.length===0){return}for(s=0,r=u.length;s<r;s++){if(u[s]===v&&s!==this.get("currentPage")){setTimeout($.proxy(function(){this.movePage(s)},this),100);break}}},onChangeCurrentPage:function(s,u){var w,v,r,t;r=this.element;v=u*this.get("height");w=this.get("scrollingSpeed");t=$.proxy(function(){this.set("animationing",false)},this);if(l){if(!r.data("hasTransitionStyle")){r.data("hasTransitionStyle",true);r.css(e("all "+w+"ms ease"))}r.one("transitionend oTransitionEnd webkitTransitionEnd",$.proxy(function(){this.get("callback")(u,this.sectionsElement.eq(u),r,this.get("animated")?t:t())},this)).css(f("translate3d(0px, -"+v+"px, 0px)"))}else{r.animate({top:-v},w,$.proxy(function(){this.get("callback")(u,this.sectionsElement.eq(u),r,this.get("animated")?t:t());},this))}}};q.init()};function f(p){return{"transform":p,"-ms-transform":p,"-moz-transform":p,"-webkit-transform":p}}function e(p){return{"transition":p,"-ms-transition":p,"-moz-transition":p,"-webkit-transition":p}}function j(){var r,p,s,q;q={"transform":"transform","OTransform":"-o-transform","msTransform":"-ms-transform","MozTransform":"-moz-transform","webkitTransform":"-webkit-transform"};r=document.createElement("p");document.body.insertBefore(r,null);for(p in q){if(r.style[p]!==undefined){r.style[p]="translate3d(1px,1px,1px)";s=window.getComputedStyle(r).getPropertyValue(q[p])}}document.body.removeChild(r);return(s!==undefined&&s.length>0&&s!=="none")}function i(){return navigator.userAgent.match(/(iPhone|iPod|iPad|Android|playbook|silk|BlackBerry|BB10|Windows Phone|Tizen|Bada|webOS|IEMobile|Opera Mini)/)}function m(p){return p.charAt(0).toUpperCase()+p.slice(1)}function c(t,s){var r,p,q;r=0;p=t.slice(Math.max(t.length-s,1));for(q=0;q<p.length;q++){r=r+p[q]}return Math.ceil(r/s)}function b(q,r){var p=q.data("mouseWheelEventName");if(!p){q.data("mouseWheelEventName",p=k())}if(window.addEventListener){document.addEventListener(p,r,false)}else{document.attachEvent(p,r,false)}}function o(q,r){var p=q.data("mouseWheelEventName");if(document.addEventListener){document.removeEventListener(p,r,false)}else{document.detachEvent(p,r)}}function k(){return"onwheel" in document.createElement("div")?"wheel":(document.onmousewheel!==undefined?(!window.addEventListener?"onmousewheel":"mousewheel"):"MozMousePixelScroll")}function a(p,q,r){$(document).on("touchstart",q);$(document).on("touchmove",r)}function h(p,q,r){$(document).off("touchstart",q);$(document).off("touchmove",r)}function g(q){var p={};p.y=(typeof q.pageY!=="undefined"&&(q.pageY||q.pageX)?q.pageY:q.touches[0].pageY);p.x=(typeof q.pageX!=="undefined"&&(q.pageY||q.pageX)?q.pageX:q.touches[0].pageX);return p}})();
