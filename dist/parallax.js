(function(){function n(b){return{transform:b,"-ms-transform":b,"-moz-transform":b,"-webkit-transform":b}}function p(b){return{transition:b,"-ms-transition":b,"-moz-transition":b,"-webkit-transition":b}}function k(b,a){var c,d,e;c=0;d=b.slice(Math.max(b.length-a,1));for(e=0;e<d.length;e++)c+=d[e];return Math.ceil(c/a)}function l(b){var a={};a.y="undefined"!==typeof b.pageY&&(b.pageY||b.pageX)?b.pageY:b.touches[0].pageY;a.x="undefined"!==typeof b.pageX&&(b.pageY||b.pageX)?b.pageX:b.touches[0].pageX;
return a}var f,m,h;f=$(window);m=function(){var b,a,c,d;d={transform:"transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",webkitTransform:"-webkit-transform"};b=document.createElement("p");document.body.insertBefore(b,null);for(a in d)void 0!==b.style[a]&&(b.style[a]="translate3d(1px,1px,1px)",c=window.getComputedStyle(b).getPropertyValue(d[a]));document.body.removeChild(b);return void 0!==c&&0<c.length&&"none"!==c}();h=navigator.userAgent.match(/(iPhone|iPod|iPad|Android|playbook|silk|BlackBerry|BB10|Windows Phone|Tizen|Bada|webOS|IEMobile|Opera Mini)/);
$.fn.parallax=function(b){b=$.extend({anchors:[],diffHeight:0,animated:!1,scrollingSpeed:1E3,bottomShowScrollBar:!1,callback:function(a,c,b,e){}},b);({attributes:{width:0,height:0,crop:null,currentPage:0,scrollingSpeed:0,animationing:!1},scrollings:[],element:$(this),sectionsElement:null,rootElement:$("body"),prevTime:(new Date).getTime(),init:function(){this.element.wrap($("<div />"));this.wrapElement=this.element.parent();this.sectionsElement=this.element.find(".section");this.touchMoveHandler=
$.proxy(this.touchMoveHandler,this);this.touchStartHandler=$.proxy(this.touchStartHandler,this);this.MouseWheelHandler=$.proxy(this.MouseWheelHandler,this);this.set("crop",!0);this.set("width",f.width());this.set("height",f.height()-b.diffHeight);this.set("anchors",b.anchors);this.set("animated",b.animated);this.set("callback",b.callback);this.set("scrollingSpeed",b.scrollingSpeed);this.set("bottomShowScrollBar",b.bottomShowScrollBar);this.renderStyle();this.bindScrollEvent();this.bindWindowResizeEvent();
this.bindWindowScrollEvent();this.element.data("instance",this)},renderStyle:function(){var a={width:"100%",height:"100%"};$("html").css($.extend({},a,{"overflow-x":"hidden"}));this.rootElement.css(a);this.wrapElement.css({overflow:"hidden",width:this.get("width"),height:this.get("height")});this.element.css($.extend({},a,{position:"relative"}));this.sectionsElement.css($.extend({},a,{position:"relative"}))},bindScrollEvent:function(){if(h){var a=this.touchStartHandler,c=this.touchMoveHandler;$(document).on("touchstart",
a);$(document).on("touchmove",c)}else{var a=this.element,c=this.MouseWheelHandler,b=a.data("mouseWheelEventName");b||a.data("mouseWheelEventName",b="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?window.addEventListener?"mousewheel":"onmousewheel":"MozMousePixelScroll");window.addEventListener?document.addEventListener(b,c,!1):document.attachEvent(b,c,!1)}},unbindScrollEvent:function(){if(h){var a=this.touchStartHandler,c=this.touchMoveHandler;$(document).off("touchstart",
a);$(document).off("touchmove",c)}else a=this.MouseWheelHandler,c=this.element.data("mouseWheelEventName"),document.addEventListener?document.removeEventListener(c,a,!1):document.detachEvent(c,a)},bindWindowResizeEvent:function(){f.on("resize",$.proxy(function(){this.set("width",f.width());this.set("height",f.height()-b.diffHeight);this.movePage(this.get("currentPage"))},this))},bindWindowScrollEvent:function(){var a=0;f.on("scroll",$.proxy(function(){0===f.scrollTop()&&(clearTimeout(a),h?this.hideScrollBar():
a=setTimeout($.proxy(function(){this.hideScrollBar()},this),100))},this))},MouseWheelHandler:function(a){var c,b,e;a.preventDefault?a.preventDefault():a.returnValue=!1;a=a||window.event;c=(new Date).getTime();b=a.wheelDelta||-a.deltaY||-a.detail;e="undefined"!==typeof a.wheelDeltaX||"undefined"!==typeof a.deltaX;a=Math.abs(a.wheelDeltaX)<Math.abs(a.wheelDelta)||Math.abs(a.deltaX)<Math.abs(a.deltaY)||!e;149<this.scrollings.length&&this.scrollings.shift();this.scrollings.push(Math.abs(b));200<c-this.prevTime&&
(this.scrollings=[]);this.prevTime=c;if(!this.get("animationing")&&k(this.scrollings,10)>=k(this.scrollings,70)&&a)this[0>Math.max(-1,Math.min(1,b))?"nextPage":"prevPage"]()},touchStartHandler:function(a){a.preventDefault();this.element.data("touchStartY",l(a.originalEvent).y)},touchMoveHandler:function(a){a.preventDefault();clearTimeout(this.__timerId);this.__timerId=setTimeout($.proxy(function(){var b,d;this.get("animationing")||(b=this.element.data("touchStartY"),d=l(a.originalEvent).y,Math.abs(b-
d)>this.get("height")/100*5&&(b>d?this.nextPage():d>b&&this.prevPage()))},this),100)},movePage:function(a){this.get("animationing")||a>=this.sectionsElement.length||this.set("currentPage",a)},prevPage:function(){var a=this.get("currentPage");0===a?this.set("animationing",!1):(this.set("animationing",!0),this.set("currentPage",--a))},nextPage:function(){var a=this.get("currentPage");a===this.sectionsElement.length-1?(this.showScrollBar(),this.set("animationing",!1)):(this.set("animationing",!0),this.set("currentPage",
++a))},showScrollBar:function(){this.set("crop",!1);this.unbindScrollEvent()},hideScrollBar:function(){this.set("crop",!0);this.bindScrollEvent()},get:function(a){return this.attributes[a]},set:function(a,b){var d="onChange"+(a.charAt(0).toUpperCase()+a.slice(1));this.attributes[a]=b;if(this[d])this[d](a,b);return this},onChangeWidth:function(a,b){this.wrapElement.css(a,b)},onChangeHeight:function(a,b){this.wrapElement.css(a,b)},onChangeCrop:function(a,b){this.rootElement.css("overflow",b?"hidden":
"visible")},onChangeBottomShowScrollBar:function(a,b){b||(this.hideScrollBar=this.showScrollBar=$.noop)},onChangeAnchors:function(a,b){var d,e,g;if((d=location.hash.slice(1))&&0!==b.length)for(e=0,g=b.length;e<g;e++)if(b[e]===d&&e!==this.get("currentPage")){setTimeout($.proxy(function(){this.movePage(e)},this),100);break}},onChangeCurrentPage:function(a,b){var d,e,g,f;g=this.element;e=b*this.get("height");d=this.get("scrollingSpeed");f=$.proxy(function(){this.set("animationing",!1)},this);m?(g.data("hasTransitionStyle")||
(g.data("hasTransitionStyle",!0),g.css(p("all "+d+"ms ease"))),g.one("transitionend oTransitionEnd webkitTransitionEnd",$.proxy(function(){this.get("callback")(b,this.sectionsElement.eq(b),g,this.get("animated")?f:f())},this)).css(n("translate3d(0px, -"+e+"px, 0px)"))):g.animate({top:-e},d,$.proxy(function(){this.get("callback")(b,this.sectionsElement.eq(b),g,this.get("animated")?f:f())},this))}}).init()}})();
